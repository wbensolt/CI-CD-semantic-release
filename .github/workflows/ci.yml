name: CI


on:
 push:
   branches: [main, develop]
 pull_request:
   branches: [main, develop]


jobs:
 pre-commit:
   name: Pre-commit checks
   runs-on: ubuntu-latest
   steps:
     - name: Checkout code
       uses: actions/checkout@v4


     - name: Set up Python
       uses: actions/setup-python@v5
       with:
         python-version: '3.13'


     - name: Run pre-commit
       uses: pre-commit/action@v3.0.0


 lint:
   name: Lint with Ruff
   runs-on: ubuntu-latest
   steps:
     - name: Checkout code
       uses: actions/checkout@v4


     - name: Set up uv
       uses: astral-sh/setup-uv@v4
       with:
         enable-cache: true
         cache-dependency-glob: "uv.lock"


     - name: Install dependencies
       run: uv sync


     - name: Run Ruff check
       run: uv run ruff check .


     - name: Run Ruff format check
       run: uv run ruff format --check .


 typecheck:
   name: Type Check with Mypy
   runs-on: ubuntu-latest
   steps:
     - name: Checkout code
       uses: actions/checkout@v4


     - name: Set up uv
       uses: astral-sh/setup-uv@v4
       with:
         enable-cache: true
         cache-dependency-glob: "uv.lock"


     - name: Install dependencies
       run: uv sync


     - name: Run Mypy
       run: uv run mypy app/


 security:
   name: Security Scan
   runs-on: ubuntu-latest
   steps:
     - name: Checkout code
       uses: actions/checkout@v4


     - name: Set up uv
       uses: astral-sh/setup-uv@v4
       with:
         enable-cache: true
         cache-dependency-glob: "uv.lock"


     - name: Install dependencies
       run: uv sync


     - name: Run Bandit
       run: uv run bandit -r app/